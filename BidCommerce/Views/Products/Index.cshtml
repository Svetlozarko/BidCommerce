@model BidCommerce.ViewModels.ProductIndexViewModel;
@{
    ViewData["Title"] = "All Products";
}

<link rel="stylesheet" href="~/css/index-products.css" />

<div class="products-container">
    <!-- Products Header -->
    <div class="products-header">
        <div>
            <h1 class="products-title">All Products</h1>
            <div class="items-count">@Model.Products.Count() items found</div>
        </div>
        <div class="products-controls">
            <form method="get" id="filterForm">
                <select name="categoryId" class="filter-dropdown" id="categoryFilter" onchange="submitFilters()">
                    <option value="">All Categories</option>
                    @foreach (var category in Model.Categories)
                    {
                       <option value="@category.CategoryId" selected="@(Model.SelectedCategoryId == category.CategoryId)">
    @category.Name
</option>

                    }
                </select>
                
                <input type="hidden" name="minPrice" id="hiddenMinPrice" value="@Model.MinPrice" />
                <input type="hidden" name="maxPrice" id="hiddenMaxPrice" value="@Model.MaxPrice" />
                <input type="hidden" name="sortBy" id="hiddenSortBy" value="@Model.SortBy" />
                <input type="hidden" name="listingType" id="hiddenListingType" value="@Model.ListingType" />
            </form>
            
            <button class="filter-dropdown" onclick="toggleFilters()">
                <i class="bi bi-funnel"></i> Filters
            </button>
            
            <select class="sort-dropdown" id="sortBy" onchange="updateSort()">
               <option value="newest" selected="@(Model.SortBy == "newest" ? "selected" : null)">Newest First</option>
               <option value="price-low" selected="@(Model.SortBy == "price-low")">Price: Low to High</option>
               <option value="price-high" selected="@(Model.SortBy == "price-high")">Price: High to Low</option>
               <option value="ending-soon" selected="@(Model.SortBy == "ending-soon")">Ending Soon</option>

            </select>
            
            <div class="view-toggle">
                <button class="view-btn active" onclick="setView('grid')">
                    <i class="bi bi-grid"></i>
                </button>
                <button class="view-btn" onclick="setView('list')">
                    <i class="bi bi-list"></i>
                </button>
            </div>
        </div>
    </div>

    <div class="main-content">
        <!-- Filters Sidebar -->
        <div class="filters-sidebar" id="filtersSidebar">
            <div class="filters-header">
                <span class="filters-title">Filters</span>
                <a href="@Url.Action("Index")" class="clear-filters">Clear All</a>
            </div>

            <!-- Price Range -->
            <div class="filter-section">
                <label class="filter-label">Price Range</label>
                <div class="price-range">
                    <input type="number" class="price-input" id="minPrice" placeholder="0" min="0" 
                           value="@Model.MinPrice" onchange="updatePriceFilter()">
                    <span>to</span>
                    <input type="number" class="price-input" id="maxPrice" placeholder="1000" min="0" 
                           value="@Model.MaxPrice" onchange="updatePriceFilter()">
                </div>
                <input type="range" class="price-slider" id="priceSlider" min="0" max="5000" 
                       value="@(Model.MaxPrice ?? 5000)" onchange="updatePriceSlider()">
            </div>

            <!-- Listing Type -->
            <div class="filter-section">
                <label class="filter-label">Listing Type</label>
                <div class="filter-checkbox">
                    <input type="radio" id="all-types" name="listingType" value="" 
                           @(string.IsNullOrEmpty(Model.ListingType) ? "checked" : "") onchange="updateListingType()">
                    <label for="all-types">All Types</label>
                </div>
                <div class="filter-checkbox">
                    <input type="radio" id="auction" name="listingType" value="auction" 
                           @(Model.ListingType == "auction" ? "checked" : "") onchange="updateListingType()">
                    <label for="auction">Auction</label>
                </div>
                <div class="filter-checkbox">
                    <input type="radio" id="buy-it-now" name="listingType" value="buy-it-now" 
                           @(Model.ListingType == "buy-it-now" ? "checked" : "") onchange="updateListingType()">
                    <label for="buy-it-now">Buy It Now</label>
                </div>
                <div class="filter-checkbox">
                    <input type="radio" id="both-types" name="listingType" value="both" 
                           @(Model.ListingType == "both" ? "checked" : "") onchange="updateListingType()">
                    <label for="both-types">Both Available</label>
                </div>
            </div>

            <button class="apply-filters-btn" onclick="submitFilters()">Apply Filters</button>
        </div>

        <!-- Products Grid -->
        <div class="products-grid" id="productsGrid">
            @if (Model.Products.Any())
            {
                @foreach (var item in Model.Products)
                {
                    <div class="product-card" data-category="@item.Category.CategoryId" data-price="@(item.CurrentBid ?? item.StartingPrice ?? 0)">
                        <div class="product-image">
                            <img src="@(string.IsNullOrEmpty(item.ImageUrl) ? "/images/placeholder-product.jpg" : item.ImageUrl)" 
                                 alt="@item.Title" />
                            @if (item.BidEndTime.HasValue && item.BidEndTime.Value <= DateTime.Now.AddHours(24))
                            {
                                <div class="ending-soon-badge">Ending Soon</div>
                            }
                            <button class="wishlist-btn" onclick="toggleWishlist(@item.Id)">
                                <i class="bi bi-heart"></i>
                            </button>
                        </div>
                        
                        <div class="product-info">
                            <div class="product-category">@item.Category.Name</div>
                            <h3 class="product-title">@item.Title</h3>
                            <p class="product-description">@(item.Description?.Length > 80 ? item.Description.Substring(0, 80) + "..." : item.Description)</p>

                            <div class="product-pricing">
                                @if (item.IsBiddable)
                                {
                                    <div class="current-bid">
                                        Current bid: $@((item.StartingPrice ?? 0).ToString("F2"))
                                    </div>
                                    @if (item.BuyNowPrice.HasValue)
                                    {
                                        <div class="buy-now-price">
                                            Buy now: $@item.BuyNowPrice.Value.ToString("F2")
                                        </div>
                                    }
                                }
                                else
                                {
                                    <div class="current-bid">
                                        Price: $@((item.BuyNowPrice ?? item.StartingPrice ?? 0).ToString("F2"))
                                    </div>
                                }
                            </div>

                            
                            <div class="product-stats">
                                <span><i class="bi bi-eye"></i> @(new Random().Next(5, 50)) watching</span>
                                @if (item.IsBiddable)
                                {
                                    <span><i class="bi bi-hammer"></i> @(new Random().Next(1, 20)) bids</span>
                                }
                                @if (item.BidEndTime.HasValue)
                                {
                                    var timeLeft = item.BidEndTime.Value - DateTime.Now;
                                    if (timeLeft.TotalDays >= 1)
                                    {
                                        <span><i class="bi bi-clock"></i> @((int)timeLeft.TotalDays)d left</span>
                                    }
                                    else if (timeLeft.TotalHours >= 1)
                                    {
                                        <span><i class="bi bi-clock"></i> @((int)timeLeft.TotalHours)h left</span>
                                    }
                                    else if (timeLeft.TotalMinutes > 0)
                                    {
                                        <span><i class="bi bi-clock"></i> @((int)timeLeft.TotalMinutes)m left</span>
                                    }
                                    else
                                    {
                                        <span><i class="bi bi-clock"></i> Ended</span>
                                    }
                                }
                            </div>
                            
                            <div class="product-actions">
                                @if (item.IsBiddable && item.BidEndTime.HasValue && item.BidEndTime.Value > DateTime.Now)
                                {
                                    <a href="@Url.Action("Details", new { id = item.Id })" class="btn-bid">
                                        <i class="bi bi-hammer"></i> Bid
                                    </a>
                                }
                                @if (item.BuyNowPrice.HasValue)
                                {
                                    <a href="@Url.Action("BuyNow", new { id = item.Id })" class="btn-buy-now">
                                        <i class="bi bi-cart"></i> Buy Now
                                    </a>
                                }
                                else if (!item.IsBiddable)
                                {
                                    <a href="@Url.Action("BuyNow", new { id = item.Id })" class="btn-buy-now">
                                        <i class="bi bi-cart"></i> Buy Now
                                    </a>
                                }
                            </div>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="no-products">
                    <i class="bi bi-search"></i>
                    <h3>No products found</h3>
                    <p>Try adjusting your filters or browse all categories.</p>
                    <a href="@Url.Action("Index")" class="btn btn-primary">View All Products</a>
                </div>
            }
        </div>
    </div>
</div>

